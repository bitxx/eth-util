package model

import (
	"context"
	"errors"
	"fmt"
	"github.com/bitxx/ethutil/model/types"
	"github.com/bitxx/ethutil/util"
	"github.com/ethereum/go-ethereum/common"
	"github.com/ethereum/go-ethereum/crypto"
	"github.com/status-im/keycard-go/hexutils"
	"strings"
	"time"
)

type Token struct {
	chain *Chain
}

func NewToken(chain *Chain) *Token {
	return &Token{
		chain: chain,
	}
}

func (t *Token) BalanceOf(address string) (balance string, err error) {
	if t.chain == nil {
		return "", errors.New("the chain node is empty")
	}
	if !util.IsValidAddress(address) {
		return "", errors.New("invalid hex address")
	}

	ctx, cancel := context.WithTimeout(context.Background(), time.Duration(t.chain.Timeout)*time.Second)
	defer cancel()
	balanceResult, err := t.chain.RemoteRpcClient.BalanceAt(ctx, common.HexToAddress(address), nil)
	if err != nil {
		return "", err
	}
	return balanceResult.String(), nil
}

func (t *Token) Transfer(privateKey, gasPrice, gasLimit, value, to string, data []byte) (hash string, err error) {
	if gasPrice == "" || gasLimit == "" || to == "" || value == "" {
		return "", errors.New("param is error")
	}
	tx := types.NewTransaction(0, gasPrice, gasLimit, to, value, data)

	priData, err := util.HexDecodeString(privateKey)
	if err != nil {
		return "", err
	}
	privateKeyECDSA, err := crypto.ToECDSA(priData)
	address := crypto.PubkeyToAddress(privateKeyECDSA.PublicKey).Hex()

	//get no sign tx
	txUnSign, err := t.chain.BuildTxUnSign(address, tx)
	if err != nil {
		return "", err
	}
	//0x60806040526004361061019c5760003560e01c80638c0c2631116100ec578063d2e5fae91161008a578063f0ead51e11610064578063f0ead51e14610524578063f8c39e4414610544578063fe4648f414610574578063ffaac0eb1461059457600080fd5b8063d2e5fae9146104c4578063d8236744146104e4578063edc20c3c1461050457600080fd5b80639dd694f4116100c65780639dd694f41461041e578063a546e8a114610464578063bd2a182014610484578063d15ef64e146104a457600080fd5b80638c0c2631146103be5780639ae0bf45146103de5780639d33b6d4146103fe57600080fd5b80635c975abb1161015957806380ae1c281161013357806380ae1c281461033357806384db809f146103485780638a3234c71461037e5780638b63aebf1461039e57600080fd5b80635c975abb146102d95780636ba6db6b146102fd57806373c45c981461031257600080fd5b8063059972d2146101a157806308a64104146101e35780631f5c64c114610229578063366b48851461024b57806344e8e4301461026b5780634b0b919d1461028b575b600080fd5b3480156101ad57600080fd5b506000546101c69061010090046001600160a01b031681565b6040516001600160a01b0390911681526020015b60405180910390f35b3480156101ef57600080fd5b5061021b6101fe366004611e0e565b600660209081526000928352604080842090915290825290205481565b6040519081526020016101da565b34801561023557600080fd5b50610249610244366004611ff2565b6105a9565b005b34801561025757600080fd5b506102496102663660046120dc565b610a5c565b34801561027757600080fd5b506002546101c6906001600160a01b031681565b34801561029757600080fd5b506102c16102a636600461212c565b6003602052600090815260409020546001600160401b031681565b6040516001600160401b0390911681526020016101da565b3480156102e557600080fd5b5060005460ff165b60405190151581526020016101da565b34801561030957600080fd5b50610249610ab3565b610325610320366004612147565b610b25565b6040516101da929190612228565b34801561033f57600080fd5b50610249610efa565b34801561035457600080fd5b506101c661036336600461224a565b6004602052600090815260409020546001600160a01b031681565b34801561038a57600080fd5b50610249610399366004612278565b610f24565b3480156103aa57600080fd5b506102496103b93660046122ea565b610fcb565b3480156103ca57600080fd5b506102496103d9366004612307565b611031565b3480156103ea57600080fd5b506102ed6103f9366004611e0e565b6110ad565b34801561040a57600080fd5b506102496104193660046122ea565b6110fc565b34801561042a57600080fd5b506104527f000000000000000000000000000000000000000000000000000000000000000181565b60405160ff90911681526020016101da565b34801561047057600080fd5b506102ed61047f366004611ff2565b611162565b34801561049057600080fd5b5061024961049f366004612340565b6113bd565b3480156104b057600080fd5b506102496104bf36600461239d565b611403565b3480156104d057600080fd5b506102496104df3660046122ea565b611446565b3480156104f057600080fd5b506102496104ff3660046120dc565b611510565b34801561051057600080fd5b5061024961051f3660046123cb565b611557565b34801561053057600080fd5b5061024961053f3660046123fe565b611620565b34801561055057600080fd5b506102ed61055f3660046122ea565b60056020526000908152604090205460ff1681565b34801561058057600080fd5b506001546101c6906001600160a01b031681565b3480156105a057600080fd5b50610249611696565b6105b16116e7565b82516105d0576040516363e60a4960e01b815260040160405180910390fd5b6105db838383611162565b6105f8576040516337077ca360e01b815260040160405180910390fd5b60005b8351811015610a56576106518482815181106106195761061961244c565b6020026020010151600001518583815181106106375761063761244c565b6020026020010151602001516001600160401b03166110ad565b1561065b57610a44565b6000600460008684815181106106735761067361244c565b602002602001015160400151815260200190815260200160002060009054906101000a90046001600160a01b031690506000818684815181106106b8576106b861244c565b6020026020010151606001516040516020016106d5929190612462565b60405160208183030381529060405280519060200120905060008290506101008785815181106107075761070761244c565b60200260200101516020015161071d91906124b0565b6001600160401b03166001901b600660008987815181106107405761074061244c565b60200260200101516000015160ff1660ff16815260200190815260200160002060006101008a88815181106107775761077761244c565b60200260200101516020015161078d91906124ec565b6001600160401b0316815260200190815260200160002060008282541792505081905550806001600160a01b031663e248cff28886815181106107d2576107d261244c565b6020026020010151604001518987815181106107f0576107f061244c565b6020026020010151606001516040518363ffffffff1660e01b8152600401610819929190612512565b6000604051808303816000875af192505050801561085957506040513d6000823e601f3d908101601f19168201604052610856919081019061252b565b60015b6109c8573d808015610887576040519150601f19603f3d011682016040523d82523d6000602084013e61088c565b606091505b507f19f774a63ee465292252a9981ae52051acc13da671c698ac4b5bf25b38c5b6fc818987815181106108c1576108c161244c565b6020026020010151600001518a88815181106108df576108df61244c565b6020026020010151602001516040516108fa939291906125a1565b60405180910390a16101008886815181106109175761091761244c565b60200260200101516020015161092d91906124b0565b6001600160401b03166001901b19600660008a88815181106109515761095161244c565b60200260200101516000015160ff1660ff16815260200190815260200160002060006101008b89815181106109885761098861244c565b60200260200101516020015161099e91906124ec565b6001600160401b0316815260208101919091526040016000208054909116905550610a4492505050565b7fb83128682faafdf78efbb57c4c9acdc12ba648a50eca00b8b72818ea2d8e5cf98886815181106109fb576109fb61244c565b602002602001015160000151898781518110610a1957610a1961244c565b6020026020010151602001518584604051610a3794939291906125d6565b60405180910390a1505050505b80610a4e81612611565b9150506105fb565b50505050565b610a796000356001600160e01b031916610a7461172d565b61176e565b7f9069464c059b9a90135a3fdf2c47855263346b912894ad7562d989532c3fad4c81604051610aa8919061262c565b60405180910390a150565b610acb6000356001600160e01b031916610a7461172d565b60005461010090046001600160a01b031615610afa5760405163229924e160e01b815260040160405180910390fd5b6040517f24e723a5c27b62883404028b8dee9965934de6a46828cda2ff63bf9a5e65ce4390600090a1565b60006060610b316116e7565b7f000000000000000000000000000000000000000000000000000000000000000160ff168860ff161415610b7857604051630137058b60e61b815260040160405180910390fd5b600080610b8361172d565b6001549091506001600160a01b0316610bee573415610be95760405162461bcd60e51b815260206004820152601d60248201527f6e6f2046656548616e646c65722c206d73672e76616c756520213d203000000060448201526064015b60405180910390fd5b610d9b565b6000600160009054906101000a90046001600160a01b03166001600160a01b031663ef4f081f837f00000000000000000000000000000000000000000000000000000000000000018e8e8e8e8e8e6040518963ffffffff1660e01b8152600401610c5f989796959493929190612668565b6040805180830381865afa158015610c7b573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610c9f91906126c4565b50905080341015610ceb5760405162461bcd60e51b8152602060048201526016602482015275125b98dbdc9c9958dd08199959481cdd5c1c1b1a595960521b6044820152606401610be0565b610cf581346126e9565b9250600160009054906101000a90046001600160a01b03166001600160a01b0316632530706582847f00000000000000000000000000000000000000000000000000000000000000018f8f8f8f8f8f6040518a63ffffffff1660e01b8152600401610d67989796959493929190612668565b6000604051808303818588803b158015610d8057600080fd5b505af1158015610d94573d6000803e3d6000fd5b5050505050505b6000898152600460205260409020546001600160a01b031680610dd1576040516308c231dd60e31b815260040160405180910390fd5b60ff8b1660009081526003602052604081208054909190610dfa906001600160401b0316612700565b91906101000a8154816001600160401b0302191690836001600160401b03160217905594506000819050806001600160a01b031663b07e54bb858d868e8e6040518663ffffffff1660e01b8152600401610e579493929190612727565b60006040518083038185885af1158015610e75573d6000803e3d6000fd5b50505050506040513d6000823e601f3d908101601f19168201604052610e9e919081019061252b565b9450826001600160a01b03167f17bc3181e17a9620a479c24e6c606e474ba84fc036877b768926872e8cd0e11f8d8d898e8e8b604051610ee396959493929190612752565b60405180910390a250505050965096945050505050565b610f126000356001600160e01b031916610a7461172d565b610f22610f1d61172d565b611828565b565b610f3c6000356001600160e01b031916610a7461172d565b60008481526004602081905260409182902080546001600160a01b0319166001600160a01b0389169081179091559151630fa8675b60e41b815287929163fa8675b091610f9191899189918991899101612727565b600060405180830381600087803b158015610fab57600080fd5b505af1158015610fbf573d6000803e3d6000fd5b50505050505050505050565b610fe36000356001600160e01b031916610a7461172d565b600180546001600160a01b0319166001600160a01b0383169081179091556040519081527f729170bd142e4965055b26a285faeedf03baf2b915bfc5a7c75d24b45815ff2c90602001610aa8565b6110496000356001600160e01b031916610a7461172d565b6040516307b7ed9960e01b81526001600160a01b0382811660048301528391908216906307b7ed99906024015b600060405180830381600087803b15801561109057600080fd5b505af11580156110a4573d6000803e3d6000fd5b50505050505050565b60006110bb610100836127a3565b60ff84166000908152600660205260408120600190921b91906110e0610100866127b7565b8152602001908152602001600020541660001415905092915050565b6111146000356001600160e01b031916610a7461172d565b600280546001600160a01b0319166001600160a01b0383169081179091556040519081527f497acaa34ac19c2a2a579ad43eca493b4fea820459e254e9383e7dda216b0f0490602001610aa8565b60008084516001600160401b0381111561117e5761117e611e38565b6040519080825280602002602001820160405280156111a7578160200160208202803683370190505b50905060005b85518110156112d9577fcc13634e956dd3d4ec8d808ee8bf294e1cd05a38f63fe7f234b079a0a4c36a708682815181106111e9576111e961244c565b6020026020010151600001518783815181106112075761120761244c565b6020026020010151602001518884815181106112255761122561244c565b6020026020010151604001518985815181106112435761124361244c565b6020026020010151606001518051906020012060405160200161129495949392919094855260ff9390931660208501526001600160401b039190911660408401526060830152608082015260a00190565b604051602081830303815290604052805190602001208282815181106112bc576112bc61244c565b6020908102919091010152806112d181612611565b9150506111ad565b50600061139d85858080601f0160208091040260200160405190810160405280939291908181526020018383808284376000920191909152505060405161139792507f989d14110ba109ccad392cc18511d1f6ae3a85165c5960e49d72c2c67682fde5915061134c9087906020016127cb565b6040516020818303038152906040528051906020012060405160200161137c929190918252602082015260400190565b60405160208183030381529060405280519060200120611876565b906118ca565b60005461010090046001600160a01b039081169116149695505050505050565b6113d56000356001600160e01b031916610a7461172d565b60405163025a3c9960e21b815282906001600160a01b03821690630968f2649061107690859060040161262c565b61141b6000356001600160e01b031916610a7461172d565b6001600160a01b03919091166000908152600560205260409020805460ff1916911515919091179055565b61145e6000356001600160e01b031916610a7461172d565b6001600160a01b03811661148557604051631449e68f60e01b815260040160405180910390fd5b60005461010090046001600160a01b0316156114b457604051632748fb3360e21b815260040160405180910390fd5b60008054610100600160a81b0319166101006001600160a01b038416021790556114e46114df61172d565b6118ee565b6040517f4187686ceef7b541a1f224d48d4cded8f2c535e0e58ac0f0514071b1de3dad5790600090a150565b6115286000356001600160e01b031916610a7461172d565b7fe78d813a9260522f81d6c761e311727b2e19008daadd2b9e174be86bc4f06a4b81604051610aa8919061262c565b61156f6000356001600160e01b031916610a7461172d565b60ff82166000908152600360205260409020546001600160401b03908116908216116115ec5760405162461bcd60e51b815260206004820152602660248201527f446f6573206e6f7420616c6c6f772064656372656d656e7473206f6620746865604482015265206e6f6e636560d01b6064820152608401610be0565b60ff919091166000908152600360205260409020805467ffffffffffffffff19166001600160401b03909216919091179055565b604080516001808252818301909252600091816020015b604080516080810182526000808252602080830182905292820152606080820152825260001990920191018161163757905050905083816000815181106116805761168061244c565b6020026020010181905250610a568184846105a9565b6116ae6000356001600160e01b031916610a7461172d565b60005461010090046001600160a01b03166116dc5760405163cca785b960e01b815260040160405180910390fd5b610f226114df61172d565b60005460ff1615610f225760405162461bcd60e51b815260206004820152601060248201526f14185d5cd8589b194e881c185d5cd95960821b6044820152606401610be0565b6000336014361080159061175957506001600160a01b03811660009081526005602052604090205460ff165b15611769575060131936013560601c5b919050565b600254604051631c72548760e21b81526001600160e01b0319841660048201526001600160a01b038381166024830152909116906371c9521c90604401602060405180830381865afa1580156117c8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906117ec9190612801565b6118245760405163039d370b60e01b81526001600160a01b03821660048201526001600160e01b031983166024820152604401610be0565b5050565b6118306116e7565b6000805460ff191660011790556040516001600160a01b03821681527f62e78cea01bee320cd4e420270b5ea74000d11b0c9f74754ebdbfc544b05a25890602001610aa8565b60006118c4611883611939565b8360405161190160f01b6020820152602281018390526042810182905260009060620160405160208183030381529060405280519060200120905092915050565b92915050565b60008060006118d98585611a60565b915091506118e681611ad0565b509392505050565b6118f6611c8e565b6000805460ff191690556040516001600160a01b03821681527f5db9ee0a495bf2e6ff9c91a7834c1ba4fdd244a5e8aa4e537bd38aeae4b073aa90602001610aa8565b6000306001600160a01b037f000000000000000000000000bd927011759b2c4f2602c3008f8ef3407db534731614801561199257507f000000000000000000000000000000000000000000000000000000000000c7ea46145b156119bc57507f1fec846bfa32081407d65a15e01bf98f1535cea391fbf8611026fd684a24550c90565b50604080517f8b73c3c69bb8fe3d512ecc4cf759cc79239f7b179b0ffacaa9a75d522b39400f6020808301919091527f7aa5ae620294318af92bf4e2b2a729646c932a80312a5fa630da993a2ef5cc10828401527f0e23d0b508e2034d01a5c31f12e9d9bbb31708c5518057dde31201ab93b17cef60608301524660808301523060a0808401919091528351808403909101815260c0909201909252805191012090565b600080825160411415611a975760208301516040840151606085015160001a611a8b87828585611cd7565b94509450505050611ac9565b825160401415611ac15760208301516040840151611ab6868383611dc4565b935093505050611ac9565b506000905060025b9250929050565b6000816004811115611ae457611ae461281e565b1415611aed5750565b6001816004811115611b0157611b0161281e565b1415611b4f5760405162461bcd60e51b815260206004820152601860248201527f45434453413a20696e76616c6964207369676e617475726500000000000000006044820152606401610be0565b6002816004811115611b6357611b6361281e565b1415611bb15760405162461bcd60e51b815260206004820152601f60248201527f45434453413a20696e76616c6964207369676e6174757265206c656e677468006044820152606401610be0565b6003816004811115611bc557611bc561281e565b1415611c1e5760405162461bcd60e51b815260206004820152602260248201527f45434453413a20696e76616c6964207369676e6174757265202773272076616c604482015261756560f01b6064820152608401610be0565b6004816004811115611c3257611c3261281e565b1415611c8b5760405162461bcd60e51b815260206004820152602260248201527f45434453413a20696e76616c6964207369676e6174757265202776272076616c604482015261756560f01b6064820152608401610be0565b50565b60005460ff16610f225760405162461bcd60e51b815260206004820152601460248201527314185d5cd8589b194e881b9bdd081c185d5cd95960621b6044820152606401610be0565b6000807f7fffffffffffffffffffffffffffffff5d576e7357a4501ddfe92f46681b20a0831115611d0e5750600090506003611dbb565b8460ff16601b14158015611d2657508460ff16601c14155b15611d375750600090506004611dbb565b6040805160008082526020820180845289905260ff881692820192909252606081018690526080810185905260019060a0016020604051602081039080840390855afa158015611d8b573d6000803e3d6000fd5b5050604051601f1901519150506001600160a01b038116611db457600060019250925050611dbb565b9150600090505b94509492505050565b6000806001600160ff1b03831681611de160ff86901c601b612834565b9050611def87828885611cd7565b935093505050935093915050565b803560ff8116811461176957600080fd5b60008060408385031215611e2157600080fd5b611e2a83611dfd565b946020939093013593505050565b634e487b7160e01b600052604160045260246000fd5b604051601f8201601f191681016001600160401b0381118282101715611e7657611e76611e38565b604052919050565b80356001600160401b038116811461176957600080fd5b60006001600160401b03821115611eae57611eae611e38565b50601f01601f191660200190565b6000611ecf611eca84611e95565b611e4e565b9050828152838383011115611ee357600080fd5b828260208301376000602084830101529392505050565b600082601f830112611f0b57600080fd5b611f1a83833560208501611ebc565b9392505050565b600060808284031215611f3357600080fd5b604051608081016001600160401b038282108183111715611f5657611f56611e38565b81604052829350611f6685611dfd565b8352611f7460208601611e7e565b6020840152604085013560408401526060850135915080821115611f9757600080fd5b50611fa485828601611efa565b6060830152505092915050565b60008083601f840112611fc357600080fd5b5081356001600160401b03811115611fda57600080fd5b602083019150836020828501011115611ac957600080fd5b60008060006040848603121561200757600080fd5b83356001600160401b038082111561201e57600080fd5b818601915086601f83011261203257600080fd5b813560208282111561204657612046611e38565b8160051b612055828201611e4e565b928352848101820192828101908b85111561206f57600080fd5b83870192505b848310156120ab5782358681111561208d5760008081fd5b61209b8d86838b0101611f21565b8352509183019190830190612075565b98505050870135925050808211156120c257600080fd5b506120cf86828701611fb1565b9497909650939450505050565b6000602082840312156120ee57600080fd5b81356001600160401b0381111561210457600080fd5b8201601f8101841361211557600080fd5b61212484823560208401611ebc565b949350505050565b60006020828403121561213e57600080fd5b611f1a82611dfd565b6000806000806000806080878903121561216057600080fd5b61216987611dfd565b95506020870135945060408701356001600160401b038082111561218c57600080fd5b6121988a838b01611fb1565b909650945060608901359150808211156121b157600080fd5b506121be89828a01611fb1565b979a9699509497509295939492505050565b60005b838110156121eb5781810151838201526020016121d3565b83811115610a565750506000910152565b600081518084526122148160208601602086016121d0565b601f01601f19169290920160200192915050565b6001600160401b038316815260406020820152600061212460408301846121fc565b60006020828403121561225c57600080fd5b5035919050565b6001600160a01b0381168114611c8b57600080fd5b60008060008060006080868803121561229057600080fd5b853561229b81612263565b94506020860135935060408601356122b281612263565b925060608601356001600160401b038111156122cd57600080fd5b6122d988828901611fb1565b969995985093965092949392505050565b6000602082840312156122fc57600080fd5b8135611f1a81612263565b6000806040838503121561231a57600080fd5b823561232581612263565b9150602083013561233581612263565b809150509250929050565b6000806040838503121561235357600080fd5b823561235e81612263565b915060208301356001600160401b0381111561237957600080fd5b61238585828601611efa565b9150509250929050565b8015158114611c8b57600080fd5b600080604083850312156123b057600080fd5b82356123bb81612263565b915060208301356123358161238f565b600080604083850312156123de57600080fd5b6123e783611dfd565b91506123f560208401611e7e565b90509250929050565b60008060006040848603121561241357600080fd5b83356001600160401b038082111561242a57600080fd5b61243687838801611f21565b945060208601359150808211156120c257600080fd5b634e487b7160e01b600052603260045260246000fd5b6bffffffffffffffffffffffff198360601b1681526000825161248c8160148501602087016121d0565b919091016014019392505050565b634e487b7160e01b600052601260045260246000fd5b60006001600160401b03808416806124ca576124ca61249a565b92169190910692915050565b634e487b7160e01b600052601160045260246000fd5b60006001600160401b03808416806125065761250661249a565b92169190910492915050565b82815260406020820152600061212460408301846121fc565b60006020828403121561253d57600080fd5b81516001600160401b0381111561255357600080fd5b8201601f8101841361256457600080fd5b8051612572611eca82611e95565b81815285602083850101111561258757600080fd5b6125988260208301602086016121d0565b95945050505050565b6060815260006125b460608301866121fc565b905060ff841660208301526001600160401b0383166040830152949350505050565b60ff851681526001600160401b038416602082015282604082015260806060820152600061260760808301846121fc565b9695505050505050565b6000600019821415612625576126256124d6565b5060010190565b602081526000611f1a60208301846121fc565b81835281816020850137506000828201602090810191909152601f909101601f19169091010190565b60018060a01b038916815260ff8816602082015260ff8716604082015285606082015260c0608082015260006126a260c08301868861263f565b82810360a08401526126b581858761263f565b9b9a5050505050505050505050565b600080604083850312156126d757600080fd5b82519150602083015161233581612263565b6000828210156126fb576126fb6124d6565b500390565b60006001600160401b038083168181141561271d5761271d6124d6565b6001019392505050565b8481526001600160a01b0384166020820152606060408201819052600090612607908301848661263f565b60ff871681528560208201526001600160401b038516604082015260a06060820152600061278460a08301858761263f565b828103608084015261279681856121fc565b9998505050505050505050565b6000826127b2576127b261249a565b500690565b6000826127c6576127c661249a565b500490565b815160009082906020808601845b838110156127f5578151855293820193908201906001016127d9565b50929695505050505050565b60006020828403121561281357600080fd5b8151611f1a8161238f565b634e487b7160e01b600052602160045260246000fd5b60008219821115612847576128476124d6565b50019056fea26469706673582212202d53da32f7299db435d3e3bf9f947468783dddeb9b56b30a9d69fec39744323c64736f6c634300080b0033
	//tx sign
	//0x02f901be82c7ea80 851695a68a0086012dfb396a00830179b5 94bd927011759b2c4f2602c3008f8ef3407db5347388b469471f80140000b9014473c45c98000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000540000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000000000014a6cf3be6506b7e1be76b60bb12754a01d56e7b2a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000008a688906bd8b00000000000000000000000000000000000000000000000000000c0 01a0150d1c25758c81aeec80f93b88847ea904aa4852b2ff5077e8abc496581c1818a00fd319c82bb07d91bcdb25cc725c4dd10ec1cf5b97de6710966d6e6dea4f67b8
	//0x02f901be82c7ea01 851695a68a0086012dfb396a00830179b5 94bd927011759b2c4f2602c3008f8ef3407db5347388b469471f80140000b9014473c45c98000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000540000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000000000014f9251c4ef894355d34d2a98a26e9d60b9d56d6bc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000008a688906bd8b00000000000000000000000000000000000000000000000000000c0 80a027b9b6800ae2ad4582b8162360ff2e6bde6d3f0aea8c0589926cd8a2db9390afa0644e695eae1521bf2318ca1594d4500372c111f1e97b635d83a31a7f1b3a5801
	//0x02f901be82c7ea80 851695a68a0086012dfb396a00830179b5 94bd927011759b2c4f2602c3008f8ef3407db5347388b469471f80140000b9014473c45c98000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000540000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000000000014f9251c4ef894355d34d2a98a26e9d60b9d56d6bc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000008a688906bd8b00000000000000000000000000000000000000000000000000000c0 01a0f0e64b59e0be5685749659a821685c0b8feb905d704e8dc305f136b394591f1ba057e4aa4722e8f564da259bbffa7ea5ec3b05a8aed6a6167e8267dc1dbfee122b
	//f901b68085e8d4a510008302a7df 94bd927011759b2c4f2602c3008f8ef3407db5347388b469471f80140000b9014473c45c98000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000540000000000000000000000000000000000000000000000000de0b6b3a76400000000000000000000000000000000000000000000000000000000000000000014f9251c4ef894355d34d2a98a26e9d60b9d56d6bc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000008a688906bd8b0000000000000000000000000000000000000000000000000000083018ff7a06414c3abc10edaeb8cb8517cbc5ff4db80f0e7c04fa676036cf70c4413d8cf9ca06f4138a17b1589fb83605b77e142e315b22b26c91ed6cf9af2f0c4b94116efc4
	txSign, err := t.chain.BuildTxSign(privateKeyECDSA, txUnSign)
	if err != nil {
		return "", err
	}
	d, _ := txSign.SignedTx.MarshalBinary()

	fmt.Println(strings.ToLower(hexutils.BytesToHex(d)))
	return "", nil
	//send tx
	return txSign.TxHex, t.chain.SendTx(txSign.SignedTx)
}

func (t *Token) EstimateGasLimit(fromAddress, receiverAddress, gasPrice, amount string, data []byte) (string, error) {
	msg := types.NewCallMsg()
	msg.SetFrom(fromAddress)
	msg.SetTo(receiverAddress)
	msg.SetGasPrice(gasPrice)
	msg.SetValue(amount)
	if data != nil {
		msg.SetData(data)
	}
	return t.chain.EstimateGasLimit(msg)
}
